# MOF InvestViz（投資統計可視化）

財務省の「対外・対内直接投資統計」（例: 6d-1-1, 6d-2）を機械可読に正規化し、探索・可視化を行うためのリポジトリです。現状は要件定義とサンプルデータを中心に整備しており、実装は段階的に追加予定です。

---

## 概要
- 目的: MOF 公表の CSV/Excel を即時に整形（tidy 化）し、ダッシュボードで分析可能にする
- 特徴: 和暦/西暦・多層ヘッダ・注釈・単位揺れを吸収する正規化フローを想定
- 出力: 正規化 CSV、基礎分析指標（前年比・CAGR 等）、多様な可視化（時系列/前年比差分/構成比/ヒートマップ/箱ひげ図）、年×系列ピボット CSV

---

## リポジトリ構成
- `docs/README.md`: 要件定義書（UTF-8, 改訂版）
- `data/6d-1-1.csv`: サンプル入力
- `data/6d-2.csv`: サンプル入力

（今後追加予定）
- `src/`: 正規化/検証/変換ロジック（実装開始済み）
- `scripts/`: 実行スクリプト（パイプライン/サーバ）
- `notebooks/`: 解析・検証用ノートブック（雛形）
- `tests/`: スキーマ検証・変換テスト（雛形）

---

## クイックスタート（現状）
- 仕様は `docs/README.md` を参照
- サンプルデータは `data/` に配置済み
- 基本操作は `docs/USAGE.md` を参照（最小パイプライン実行とダッシュボード表示）

---

## データと用語
- side: `assets`（対外）、`liabilities`（対内）、`unknown`（不明）
- metric: `flow`（フロー）、`reinvested`（再投資収益）、`net`（原表ネット）、`net_computed`（自算ネット）
- 単位: 正規化後は「億円」に統一（`value_100m_yen`）

---

## エンコーディング方針
- すべてのテキストファイルは UTF-8（BOM なし）
- 入力データの自動判定（CP932/Shift_JIS/UTF-8/UTF-8-SIG）を想定

---

## 主な機能
- **正規化パイプライン**: CP932/Shift_JIS/UTF-8 自動判定、多層ヘッダ解析、和暦→西暦変換
- **多様な可視化**: 時系列、前年比差分、構成比、ヒートマップ、箱ひげ図
- **地域別分析**: 地域情報の自動抽出と地域フィルタによる比較（アジア、北米、欧州など主要地域・国に対応）
- **外れ値検知**: MAD（中央絶対偏差）ベースのロバスト外れ値検知
- **CSVエクスポート**: ダッシュボードから現在のビューとフィルタを適用したデータをワンクリックでCSVダウンロード
- **データエクスポート**: 正規化CSV、年×系列ピボットCSV、処理ログJSON

## 今後のロードマップ
- **フェーズ1（完了）**: 正規化パイプライン整備、`parse_log.json` 詳細化、ダッシュボード MVP（時系列/前年比差分/構成比/ヒートマップ/箱ひげ図）、地域別分析機能、ダッシュボードCSVエクスポート機能
- **フェーズ2（次のゴール）**
  - 描画品質の向上（軸表記・配色・ツールチップ・凡例・高 DPI 対応）
  - 正規化処理の改善（ヘッダー解析精度向上、metric/side検出強化）
- **フェーズ3**: 大規模データ向け最適化（LTTB ダウンサンプリング、Web Worker）、注釈・外れ値ハイライト、自動テスト/CI、共有可能なダッシュボードエクスポート

---

## ライセンス / データ出典
- ライセンスは未設定（必要に応じて追加）
- データ出典: 財務省公表資料（各 CSV のメタに記録予定）
