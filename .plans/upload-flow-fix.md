# Upload Flow Fix & Multi-Upload

## Goal
- 既存のサマリが存在していても「新しいCSVをアップロード」できる導線をUIに追加し、連続アップロード→即時再分析が可能な状態にする。
- `/api/upload` の挙動は現状維持（アップロードごとに一時ディレクトリへ保存し、正規化・サマリ・ピボットを生成）。

## Current Issue
- `build/summary.json` が存在すると、ページ初期表示時に `loadExistingSummary()` が成功し、`uploader` パネルが非表示になるため、新規アップロードのUIが見当たらない。
- 関連コード：`src/mof_investviz/ui.py` の初期化ロジックとパネル表示切替。

## Deliverables
- ヘッダーに「新規CSVをアップロード」ボタンを追加（ショートカットキー含む）。
- クリックで `uploader` を表示、現在の `gData` を一時的に保持 or 破棄を選択できるUI（簡易版は上書きでOK）。
- ドラッグ＆ドロップは常時有効化（全画面ドロップターゲットを活かす）し、`uploader` 非表示時でもドロップでアップロード開始可能にする（オプション）。
- アップロード成功後、リンク群（normalized.csv / parse_log.json / pivot）を新セッションのURLに更新。
- ドキュメントに「連続アップロード」の手順を追記。

## Work Breakdown
1. UI 仕様
   - ヘッダー右上にボタン「新規CSVをアップロード」。
   - 押下時：`uploader` を表示、`controls`/`chartPanel` は一時的に非表示。
   - ドロップ対応：`document` にドロップハンドラを付与し、`uploader` 非表示でも受け付ける（導線強化）。
2. 状態遷移
   - `gData` の扱い：再アップロード時は新データで上書き（戻る操作はスコープ外）。
   - 既存 `loadExistingSummary()` の挙動は維持しつつ、常にアップロード導線が見えるように調整。
3. API/バックエンド
   - 現行の `/api/upload` を継続使用（変更不要）。
   - 成功レスポンスにより UI のリンク更新（`/uploads/<sid>/...`）。
4. ドキュメント
   - `docs/USAGE.md` に「新規CSVアップロード」「連続アップロード」の手順と注意事項を追記。
5. 検証
   - ブラウザ手動QA：既存summary表示 → 新規CSVアップロード → グラフ再描画・リンク更新・エクスポート動作確認。

## Acceptance Criteria
- 既存summaryがあっても、1クリックで新規アップロードが可能。
- アップロード直後にグラフが新データで再描画され、CSVエクスポートが整合。
- 連続アップロード（2回以上）でもエラーなく切替可能。

