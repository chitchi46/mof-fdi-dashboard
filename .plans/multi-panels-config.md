# Multi Panels Configuration & Fixes

## 目的
- マルチパネル（2×2 など）で表示サイズの不正を解消し、表示するグラフ数・種類・レイアウトをユーザーが選べるようにする。
- 単一ビューと同等の操作/エクスポート機能を維持（CSV/画像/ツールチップ等）。

## 要件
- パネル数: 1 / 2 / 3 / 4 を選択可能。
- レイアウト: 1×2 / 2×1 / 2×2 を選択（3 の場合は 2×2 の一部空き）。
- グラフ種類: 各パネルに対して ChartTypePicker で指定（時系列/前年比差/構成比/棒(縦/横)/国別円）。
- キャンバスサイズ: コンテナの実サイズを取得して DPI 対応でリサイズ（devicePixelRatio）。
- 同期: フィルタ（系列/年/地域）を全パネルに同期（パネル単独モードの切替可）。
- 動作修正: マルチパネル時に横棒だけになる不具合を修正（向きトグルを尊重）。

## 作業分解
1. レイアウトコンテナのリファクタ（CSS Grid: rows/cols をオプション化）。
2. パネルごとのキャンバスリサイズ（IntersectionObserver/ResizeObserver）。
3. ChartTypePicker と PanelCount/Arrangement の UI 追加・保存/復元（URLハッシュ/LocalStorage）。
4. 描画ルータの修正（棒縦/横の分岐を明確化、マルチパネルでも同じ分岐を使用）。
5. エクスポートをパネル単位/全体で対応（CSV/PNG）。
6. 回帰テスト（単一/マルチでの表示・エクスポート一致）。

## 受け入れ基準
- 1〜4 パネルでコンテナサイズに応じた正しいキャンバス領域が確保される。
- 向きトグルが単一/マルチの両方で機能（横棒/縦棒が選択通り表示）。
- ユーザーが選択したグラフ種類・パネル数・並びが保持される。
- エクスポート（CSV/画像）が選択状態と一致。
